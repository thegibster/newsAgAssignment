APP.Main=function(){function e(e,n){for(var i=document.querySelectorAll(".story"),o=0;o<i.length;o++)if(i[o].getAttribute("id")==="s-"+e){n.time*=1e3;var l=i[o],a=b(n);l.innerHTML=a,l.addEventListener("click",t.bind(this,n)),l.classList.add("clickable"),y--}0===y&&r()}function t(e){var t=a("sd-"+e.id);if(setTimeout(n.bind(this,e.id),60),!t){e.url&&(e.urlobj=new URL(e.url));var r,o,l,s,d=L(e),c=e.kids,u=C({by:"",text:"Loading comment..."});t=document.createElement("section"),t.setAttribute("id","sd-"+e.id),t.classList.add("story-details"),t.innerHTML=d,document.body.appendChild(t),o=t.querySelector(".js-comments"),l=t.querySelector(".js-header"),s=t.querySelector(".js-content");var m=t.querySelector(".js-close");m.addEventListener("click",i.bind(this,e.id));var y=l.getBoundingClientRect().height;if(s.style.paddingTop=y+"px","undefined"==typeof c)return;for(var p=0;p<c.length;p++)r=document.createElement("aside"),r.setAttribute("id","sdc-"+c[p]),r.classList.add("story-details__comment"),r.innerHTML=u,o.appendChild(r),APP.Data.getStoryComment(c[p],function(e){e.time*=1e3;var t=o.querySelector("#sdc-"+e.id);t.innerHTML=C(e,f)})}}function n(e){function t(){var e=n.getBoundingClientRect();null===i&&(i=e.left),i+=.1*(0-e.left),Math.abs(i)>.5?setTimeout(t,4):i=0,n.style.left=i+"px"}if(!m){m=!0;var n=a("#sd-"+e),i=null;n&&(document.body.classList.add("details-active"),n.style.opacity=1,setTimeout(t,4))}}function i(e){function t(){var e=u.getBoundingClientRect(),r=n.getBoundingClientRect(),o=e.width+100;i+=.1*(o-r.left),Math.abs(i-o)>.5?requestAnimationFrame(t):(i=o,m=!1),n.style.left=i+"px"}if(m){var n=a("#sd-"+e),i=0;document.body.classList.remove("details-active"),n.style.opacity=0,requestAnimationFrame(t)}}function r(){for(var e=0;e<S.length;e++){var t=S[e],n=t.querySelector(".story__score"),i=t.querySelector(".story__title"),r=u.offsetHeight,o=(u.getBoundingClientRect(),n.getBoundingClientRect().top-document.body.getBoundingClientRect().top),l=Math.min(1,1-.05*((o-170)/r)),a=Math.min(1,1-.5*((o-170)/r));n.style.width=40*l+"px",n.style.height=40*l+"px",n.style.lineHeight=40*l+"px",o=n.getBoundingClientRect();var s=100*((o.width-38)/2);n.style.backgroundColor="hsl(42, "+s+"%, 50%)",i.style.opacity=a}}function o(){if(!(y>0)){y=c;for(var t=d+c,n=d;t>n;n++){if(n>=s.length)return;var i=String(s[n]),r=document.createElement("div");r.setAttribute("id","s-"+i),r.classList.add("story"),r.innerHTML=b({title:"...",score:"-",by:"...",time:0}),u.appendChild(r),APP.Data.getStoryById(s[n],e.bind(this,i))}d+=c}}var l=300,a=document.querySelector.bind(document),s=null,d=0,c=100,u=a("main"),m=!1,y=0,f={data:{intl:{locales:"en-US"}}},p=a("#tmpl-story").textContent,g=a("#tmpl-story-details").textContent,h=a("#tmpl-story-details-comment").textContent;if("undefined"!=typeof HandlebarsIntl)HandlebarsIntl.registerWith(Handlebars);else{var v=/, {{ formatRelative time }}/;p=p.replace(v,""),g=g.replace(v,""),h=h.replace(v,"")}var b=Handlebars.compile(p),L=Handlebars.compile(g),C=Handlebars.compile(h),S=document.querySelectorAll(".story");u.addEventListener("touchstart",function(e){Math.random()>.97&&e.preventDefault()});var H=a("header"),T=H.querySelector(".header__title-wrapper");u.addEventListener("scroll",function(){var e=Math.min(70,u.scrollTop),t="scale("+(1-e/300)+")";r(),H.style.height=156-e+"px",T.style.webkitTransform=t,T.style.transform=t,u.scrollTop>70?document.body.classList.add("raised"):document.body.classList.remove("raised");var n=u.scrollHeight-u.offsetHeight-l;u.scrollTop>n&&o()}),APP.Data.getTopStories(function(e){s=e,o(),u.classList.remove("loading")})}();
